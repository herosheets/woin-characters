
angular = require('angular');

angular.module('woin-character')
  .controller('ExploitsCtrl', function ExploitsCtrl($scope, $rootScope) {

      $scope.testData = {
          skill: {
              piloting: 1,
              anatomy: 1
          },
          attribute: {
              agi: 8,
              log: 7
          },
          exploit: {
              aim: 1
          }
      };

    var deleteFromArray = function(array, c) {
      var index = array.indexOf(c);
      array.splice(index, 1);
    };

    var KEY = $scope.KEY = 'Exploits';

    $scope.exploitsHash = $scope.$parent.exploitsHash;

    $scope.localExploits = [];
    angular.copy($scope.exploits, $scope.localExploits);
    console.log("Copy:");
    console.log($scope.localExploits);

    console.log("Exploits:");
    console.log($scope.character.exploits);

    if ($scope.character.exploits === undefined) {
      $scope.character.exploits = [];
    };

    angular.forEach($scope.character.exploits, function(c) {
      deleteFromArray($scope.localExploits, c);
    });

    $scope.addItem = function(c) {
      $scope.character.exploits.push(c);
      deleteFromArray($scope.localExploits, c);
    };

    $scope.isRaceExploit = function(exploit) { return _.contains($rootScope.raceExploits || [], exploit); };

    $scope.canAddMoreItems = function() {
        var allExploits = $scope.character.exploits;
        var ignoredExploits = $rootScope.raceExploits || [];
        var exploitsCount = 0;
        _.each(allExploits, function(exploit) {
            if(_.contains(ignoredExploits, exploit.Exploit)) return;
            exploitsCount++;
        });

        return exploitsCount < 4;
    }

    $scope.removeItem = function(c) {
      $scope.localExploits.push(c);
      deleteFromArray($scope.character.exploits, c);
    };

  });